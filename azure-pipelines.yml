trigger:
- jenkins

pool:
  vmImage: ubuntu-latest

parameters:
  - name: DockerID
    type: string
    default: $(DOCKER_USERNAME)
  - name: DockerPassword
    type: string
    default: $(DOCKER_PASSWORD) 

steps:
- task: NodeTool@0
  inputs:
    versionSpec: '23.1'
    checkLatest: true

- script: |
    npm install -g pnpm
    pnpm install
    pnpm run test
  displayName: 'Set up npm and pnpm environment'

# Docker build and push steps
- task: Docker@2
  inputs:
    containerRegistry: 'docker-svc-connection' # Use a service connection for Docker Hub
    repository: '$(DOCKER_USERNAME)/express-api-azure'
    command: 'buildAndPush'
    Dockerfile: '**/Dockerfile'  # Path to Dockerfile
    tags: |
      green

# Logout
- script: |
    docker logout
  displayName: 'Log out of Docker Hub'
